## create directory needed for mongo ##
sleep 30
sudo mkdir /var/log/mongodb -p
sudo mkdir /data -p
sudo mkdir /data/mongodb -p


## remove default config file ##
sudo rm /etc/mongod.conf


## creating the config file ##
sudo echo "
systemLog:
  destination: file
  path: /var/log/mongodb/mongo.log
  logAppend: true
storage:
  dbPath: /data/mongodb
net:
  bindIp: ${internalIp} 
  port: ${port}
sharding:
  clusterRole: shardsvr
replication:
  replSetName: ${replicaSetName}
" >> /etc/mongod.conf



## starting the mongo instance ##
mongod --config /etc/mongod.conf & 
sleep 10

## initiate replica set ##
mongo --host ${internalIp} --port ${port} --eval "rs.initiate();"

sleep 5

## add shard to cluster ##
mongo --host ${router_internal_ip} --port ${router_port} --eval "sh.addShard('${replicaSetName}/${internalIp}:${port}')"